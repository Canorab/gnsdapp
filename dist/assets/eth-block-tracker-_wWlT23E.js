import{c as d}from"./@babel-BTUyE5mg.js";import{j as ce}from"./json-rpc-random-id-DmWAYPg7.js";import{c as Ae}from"./@metamask-D5jLp4R4.js";import{r as w}from"./superstruct-D_tVzfND.js";import{b as Me}from"./debug-Kk5lNELL.js";import{s as Le}from"./semver-MVTUpC9i.js";var Ce={},L={};const Y=(e,t)=>function(){const n=t.promiseModule,r=new Array(arguments.length);for(let i=0;i<arguments.length;i++)r[i]=arguments[i];return new n((i,s)=>{t.errorFirst?r.push(function(o,l){if(t.multiArgs){const h=new Array(arguments.length-1);for(let c=1;c<arguments.length;c++)h[c-1]=arguments[c];o?(h.unshift(o),s(h)):i(h)}else o?s(o):i(l)}):r.push(function(o){if(t.multiArgs){const l=new Array(arguments.length-1);for(let h=0;h<arguments.length;h++)l[h]=arguments[h];i(l)}else i(o)}),e.apply(this,r)})};var $e=(e,t)=>{t=Object.assign({exclude:[/.+(Sync|Stream)$/],errorFirst:!0,promiseModule:Promise},t);const n=i=>{const s=o=>typeof o=="string"?i===o:o.test(i);return t.include?t.include.some(s):!t.exclude.some(s)};let r;typeof e=="function"?r=function(){return t.excludeMain?e.apply(this,arguments):Y(e,t).apply(this,arguments)}:r=Object.create(Object.getPrototypeOf(e));for(const i in e){const s=e[i];r[i]=typeof s=="function"&&n(i)?Y(s,t):s}return r},N={},He=d&&d.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(N,"__esModule",{value:!0});N.BaseBlockTracker=void 0;const Fe=He(Ae),Ue=1e3,ze=(e,t)=>e+t,Z=["sync","latest"];class qe extends Fe.default{constructor(t){super(),this._blockResetDuration=t.blockResetDuration||20*Ue,this._usePastBlocks=t.usePastBlocks||!1,this._currentBlock=null,this._isRunning=!1,this._onNewListener=this._onNewListener.bind(this),this._onRemoveListener=this._onRemoveListener.bind(this),this._resetCurrentBlock=this._resetCurrentBlock.bind(this),this._setupInternalEvents()}async destroy(){this._cancelBlockResetTimeout(),await this._maybeEnd(),super.removeAllListeners()}isRunning(){return this._isRunning}getCurrentBlock(){return this._currentBlock}async getLatestBlock(){return this._currentBlock?this._currentBlock:await new Promise(n=>this.once("latest",n))}removeAllListeners(t){return t?super.removeAllListeners(t):super.removeAllListeners(),this._setupInternalEvents(),this._onRemoveListener(),this}_setupInternalEvents(){this.removeListener("newListener",this._onNewListener),this.removeListener("removeListener",this._onRemoveListener),this.on("newListener",this._onNewListener),this.on("removeListener",this._onRemoveListener)}_onNewListener(t){Z.includes(t)&&this._maybeStart()}_onRemoveListener(){this._getBlockTrackerEventCount()>0||this._maybeEnd()}async _maybeStart(){this._isRunning||(this._isRunning=!0,this._cancelBlockResetTimeout(),await this._start(),this.emit("_started"))}async _maybeEnd(){this._isRunning&&(this._isRunning=!1,this._setupBlockResetTimeout(),await this._end(),this.emit("_ended"))}_getBlockTrackerEventCount(){return Z.map(t=>this.listenerCount(t)).reduce(ze)}_shouldUseNewBlock(t){const n=this._currentBlock;if(!n)return!0;const r=K(t),i=K(n);return this._usePastBlocks&&r<i||r>i}_newPotentialLatest(t){this._shouldUseNewBlock(t)&&this._setCurrentBlock(t)}_setCurrentBlock(t){const n=this._currentBlock;this._currentBlock=t,this.emit("latest",t),this.emit("sync",{oldBlock:n,newBlock:t})}_setupBlockResetTimeout(){this._cancelBlockResetTimeout(),this._blockResetTimeout=setTimeout(this._resetCurrentBlock,this._blockResetDuration),this._blockResetTimeout.unref&&this._blockResetTimeout.unref()}_cancelBlockResetTimeout(){this._blockResetTimeout&&clearTimeout(this._blockResetTimeout)}_resetCurrentBlock(){this._currentBlock=null}}N.BaseBlockTracker=qe;function K(e){return Number.parseInt(e,16)}var oe={},ae={},b={};Object.defineProperty(b,"__esModule",{value:!0});b.assertExhaustive=b.assertStruct=b.assert=b.AssertionError=void 0;const De=w;function We(e){return typeof e=="object"&&e!==null&&"message"in e}function Xe(e){var t,n;return typeof((n=(t=e==null?void 0:e.prototype)===null||t===void 0?void 0:t.constructor)===null||n===void 0?void 0:n.name)=="string"}function Ge(e){const t=We(e)?e.message:String(e);return t.endsWith(".")?t.slice(0,-1):t}function ue(e,t){return Xe(e)?new e({message:t}):e({message:t})}class q extends Error{constructor(t){super(t.message),this.code="ERR_ASSERTION"}}b.AssertionError=q;function Qe(e,t="Assertion failed.",n=q){if(!e)throw t instanceof Error?t:ue(n,t)}b.assert=Qe;function Ye(e,t,n="Assertion failed",r=q){try{(0,De.assert)(e,t)}catch(i){throw ue(r,`${n}: ${Ge(i)}.`)}}b.assertStruct=Ye;function Ze(e){throw new Error("Invalid branch reached. Should be detected during compilation.")}b.assertExhaustive=Ze;var O={};Object.defineProperty(O,"__esModule",{value:!0});O.base64=void 0;const Ke=w,xe=b,et=(e,t={})=>{var n,r;const i=(n=t.paddingRequired)!==null&&n!==void 0?n:!1,s=(r=t.characterSet)!==null&&r!==void 0?r:"base64";let o;s==="base64"?o=String.raw`[A-Za-z0-9+\/]`:((0,xe.assert)(s==="base64url"),o=String.raw`[-_A-Za-z0-9]`);let l;return i?l=new RegExp(`^(?:${o}{4})*(?:${o}{3}=|${o}{2}==)?$`,"u"):l=new RegExp(`^(?:${o}{4})*(?:${o}{2,3}|${o}{3}=|${o}{2}==)?$`,"u"),(0,Ke.pattern)(e,l)};O.base64=et;var u={},A={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.remove0x=e.add0x=e.assertIsStrictHexString=e.assertIsHexString=e.isStrictHexString=e.isHexString=e.StrictHexStruct=e.HexStruct=void 0;const t=w,n=b;e.HexStruct=(0,t.pattern)((0,t.string)(),/^(?:0x)?[0-9a-f]+$/iu),e.StrictHexStruct=(0,t.pattern)((0,t.string)(),/^0x[0-9a-f]+$/iu);function r(c){return(0,t.is)(c,e.HexStruct)}e.isHexString=r;function i(c){return(0,t.is)(c,e.StrictHexStruct)}e.isStrictHexString=i;function s(c){(0,n.assert)(r(c),"Value must be a hexadecimal string.")}e.assertIsHexString=s;function o(c){(0,n.assert)(i(c),'Value must be a hexadecimal string, starting with "0x".')}e.assertIsStrictHexString=o;function l(c){return c.startsWith("0x")?c:c.startsWith("0X")?`0x${c.substring(2)}`:`0x${c}`}e.add0x=l;function h(c){return c.startsWith("0x")||c.startsWith("0X")?c.substring(2):c}e.remove0x=h})(A);Object.defineProperty(u,"__esModule",{value:!0});u.createDataView=u.concatBytes=u.valueToBytes=u.stringToBytes=u.numberToBytes=u.signedBigIntToBytes=u.bigIntToBytes=u.hexToBytes=u.bytesToString=u.bytesToNumber=u.bytesToSignedBigInt=u.bytesToBigInt=u.bytesToHex=u.assertIsBytes=u.isBytes=void 0;const y=b,z=A,x=48,ee=58,te=87;function tt(){const e=[];return()=>{if(e.length===0)for(let t=0;t<256;t++)e.push(t.toString(16).padStart(2,"0"));return e}}const nt=tt();function D(e){return e instanceof Uint8Array}u.isBytes=D;function j(e){(0,y.assert)(D(e),"Value must be a Uint8Array.")}u.assertIsBytes=j;function le(e){if(j(e),e.length===0)return"0x";const t=nt(),n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=t[e[r]];return(0,z.add0x)(n.join(""))}u.bytesToHex=le;function fe(e){j(e);const t=le(e);return BigInt(t)}u.bytesToBigInt=fe;function rt(e){j(e);let t=BigInt(0);for(const n of e)t=(t<<BigInt(8))+BigInt(n);return BigInt.asIntN(e.length*8,t)}u.bytesToSignedBigInt=rt;function st(e){j(e);const t=fe(e);return(0,y.assert)(t<=BigInt(Number.MAX_SAFE_INTEGER),"Number is not a safe integer. Use `bytesToBigInt` instead."),Number(t)}u.bytesToNumber=st;function it(e){return j(e),new TextDecoder().decode(e)}u.bytesToString=it;function C(e){var t;if(((t=e==null?void 0:e.toLowerCase)===null||t===void 0?void 0:t.call(e))==="0x")return new Uint8Array;(0,z.assertIsHexString)(e);const n=(0,z.remove0x)(e).toLowerCase(),r=n.length%2===0?n:`0${n}`,i=new Uint8Array(r.length/2);for(let s=0;s<i.length;s++){const o=r.charCodeAt(s*2),l=r.charCodeAt(s*2+1),h=o-(o<ee?x:te),c=l-(l<ee?x:te);i[s]=h*16+c}return i}u.hexToBytes=C;function ge(e){(0,y.assert)(typeof e=="bigint","Value must be a bigint."),(0,y.assert)(e>=BigInt(0),"Value must be a non-negative bigint.");const t=e.toString(16);return C(t)}u.bigIntToBytes=ge;function ct(e,t){(0,y.assert)(t>0);const n=e>>BigInt(31);return!((~e&n)+(e&~n)>>BigInt(t*8+-1))}function ot(e,t){(0,y.assert)(typeof e=="bigint","Value must be a bigint."),(0,y.assert)(typeof t=="number","Byte length must be a number."),(0,y.assert)(t>0,"Byte length must be greater than 0."),(0,y.assert)(ct(e,t),"Byte length is too small to represent the given value.");let n=e;const r=new Uint8Array(t);for(let i=0;i<r.length;i++)r[i]=Number(BigInt.asUintN(8,n)),n>>=BigInt(8);return r.reverse()}u.signedBigIntToBytes=ot;function de(e){(0,y.assert)(typeof e=="number","Value must be a number."),(0,y.assert)(e>=0,"Value must be a non-negative number."),(0,y.assert)(Number.isSafeInteger(e),"Value is not a safe integer. Use `bigIntToBytes` instead.");const t=e.toString(16);return C(t)}u.numberToBytes=de;function he(e){return(0,y.assert)(typeof e=="string","Value must be a string."),new TextEncoder().encode(e)}u.stringToBytes=he;function _e(e){if(typeof e=="bigint")return ge(e);if(typeof e=="number")return de(e);if(typeof e=="string")return e.startsWith("0x")?C(e):he(e);if(D(e))return e;throw new TypeError(`Unsupported value type: "${typeof e}".`)}u.valueToBytes=_e;function at(e){const t=new Array(e.length);let n=0;for(let i=0;i<e.length;i++){const s=_e(e[i]);t[i]=s,n+=s.length}const r=new Uint8Array(n);for(let i=0,s=0;i<t.length;i++)r.set(t[i],s),s+=t[i].length;return r}u.concatBytes=at;function ut(e){if(typeof Buffer<"u"&&e instanceof Buffer){const t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return new DataView(t)}return new DataView(e.buffer,e.byteOffset,e.byteLength)}u.createDataView=ut;var $={};Object.defineProperty($,"__esModule",{value:!0});$.ChecksumStruct=void 0;const ne=w,lt=O;$.ChecksumStruct=(0,ne.size)((0,lt.base64)((0,ne.string)(),{paddingRequired:!0}),44,44);var v={};Object.defineProperty(v,"__esModule",{value:!0});v.createHex=v.createBytes=v.createBigInt=v.createNumber=void 0;const f=w,ft=b,be=u,H=A,me=(0,f.union)([(0,f.number)(),(0,f.bigint)(),(0,f.string)(),H.StrictHexStruct]),gt=(0,f.coerce)((0,f.number)(),me,Number),dt=(0,f.coerce)((0,f.bigint)(),me,BigInt);(0,f.union)([H.StrictHexStruct,(0,f.instance)(Uint8Array)]);const ht=(0,f.coerce)((0,f.instance)(Uint8Array),(0,f.union)([H.StrictHexStruct]),be.hexToBytes),_t=(0,f.coerce)(H.StrictHexStruct,(0,f.instance)(Uint8Array),be.bytesToHex);function bt(e){try{const t=(0,f.create)(e,gt);return(0,ft.assert)(Number.isFinite(t),`Expected a number-like value, got "${e}".`),t}catch(t){throw t instanceof f.StructError?new Error(`Expected a number-like value, got "${e}".`):t}}v.createNumber=bt;function mt(e){try{return(0,f.create)(e,dt)}catch(t){throw t instanceof f.StructError?new Error(`Expected a number-like value, got "${String(t.value)}".`):t}}v.createBigInt=mt;function St(e){if(typeof e=="string"&&e.toLowerCase()==="0x")return new Uint8Array;try{return(0,f.create)(e,ht)}catch(t){throw t instanceof f.StructError?new Error(`Expected a bytes-like value, got "${String(t.value)}".`):t}}v.createBytes=St;function yt(e){if(e instanceof Uint8Array&&e.length===0||typeof e=="string"&&e.toLowerCase()==="0x")return"0x";try{return(0,f.create)(e,_t)}catch(t){throw t instanceof f.StructError?new Error(`Expected a bytes-like value, got "${String(t.value)}".`):t}}v.createHex=yt;var E={},Se=d&&d.__classPrivateFieldSet||function(e,t,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(e,n):i?i.value=n:t.set(e,n),n},S=d&&d.__classPrivateFieldGet||function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},R,B;Object.defineProperty(E,"__esModule",{value:!0});E.FrozenSet=E.FrozenMap=void 0;class W{constructor(t){R.set(this,void 0),Se(this,R,new Map(t),"f"),Object.freeze(this)}get size(){return S(this,R,"f").size}[(R=new WeakMap,Symbol.iterator)](){return S(this,R,"f")[Symbol.iterator]()}entries(){return S(this,R,"f").entries()}forEach(t,n){return S(this,R,"f").forEach((r,i,s)=>t.call(n,r,i,this))}get(t){return S(this,R,"f").get(t)}has(t){return S(this,R,"f").has(t)}keys(){return S(this,R,"f").keys()}values(){return S(this,R,"f").values()}toString(){return`FrozenMap(${this.size}) {${this.size>0?` ${[...this.entries()].map(([t,n])=>`${String(t)} => ${String(n)}`).join(", ")} `:""}}`}}E.FrozenMap=W;class X{constructor(t){B.set(this,void 0),Se(this,B,new Set(t),"f"),Object.freeze(this)}get size(){return S(this,B,"f").size}[(B=new WeakMap,Symbol.iterator)](){return S(this,B,"f")[Symbol.iterator]()}entries(){return S(this,B,"f").entries()}forEach(t,n){return S(this,B,"f").forEach((r,i,s)=>t.call(n,r,i,this))}has(t){return S(this,B,"f").has(t)}keys(){return S(this,B,"f").keys()}values(){return S(this,B,"f").values()}toString(){return`FrozenSet(${this.size}) {${this.size>0?` ${[...this.values()].map(t=>String(t)).join(", ")} `:""}}`}}E.FrozenSet=X;Object.freeze(W);Object.freeze(W.prototype);Object.freeze(X);Object.freeze(X.prototype);var ye={};Object.defineProperty(ye,"__esModule",{value:!0});var Re={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getJsonRpcIdValidator=e.assertIsJsonRpcError=e.isJsonRpcError=e.assertIsJsonRpcFailure=e.isJsonRpcFailure=e.assertIsJsonRpcSuccess=e.isJsonRpcSuccess=e.assertIsJsonRpcResponse=e.isJsonRpcResponse=e.assertIsPendingJsonRpcResponse=e.isPendingJsonRpcResponse=e.JsonRpcResponseStruct=e.JsonRpcFailureStruct=e.JsonRpcSuccessStruct=e.PendingJsonRpcResponseStruct=e.assertIsJsonRpcRequest=e.isJsonRpcRequest=e.assertIsJsonRpcNotification=e.isJsonRpcNotification=e.JsonRpcNotificationStruct=e.JsonRpcRequestStruct=e.JsonRpcParamsStruct=e.JsonRpcErrorStruct=e.JsonRpcIdStruct=e.JsonRpcVersionStruct=e.jsonrpc2=e.getJsonSize=e.isValidJson=e.JsonStruct=e.UnsafeJsonStruct=void 0;const t=w,n=b,r=()=>(0,t.define)("finite number",a=>(0,t.is)(a,(0,t.number)())&&Number.isFinite(a));e.UnsafeJsonStruct=(0,t.union)([(0,t.literal)(null),(0,t.boolean)(),r(),(0,t.string)(),(0,t.array)((0,t.lazy)(()=>e.UnsafeJsonStruct)),(0,t.record)((0,t.string)(),(0,t.lazy)(()=>e.UnsafeJsonStruct))]),e.JsonStruct=(0,t.define)("Json",(a,_)=>{function M(k,G){const Q=[...G.validator(k,_)];return Q.length>0?Q:!0}try{const k=M(a,e.UnsafeJsonStruct);return k!==!0?k:M(JSON.parse(JSON.stringify(a)),e.UnsafeJsonStruct)}catch(k){return k instanceof RangeError?"Circular reference detected":!1}});function i(a){return(0,t.is)(a,e.JsonStruct)}e.isValidJson=i;function s(a){(0,n.assertStruct)(a,e.JsonStruct,"Invalid JSON value");const _=JSON.stringify(a);return new TextEncoder().encode(_).byteLength}e.getJsonSize=s,e.jsonrpc2="2.0",e.JsonRpcVersionStruct=(0,t.literal)(e.jsonrpc2),e.JsonRpcIdStruct=(0,t.nullable)((0,t.union)([(0,t.number)(),(0,t.string)()])),e.JsonRpcErrorStruct=(0,t.object)({code:(0,t.integer)(),message:(0,t.string)(),data:(0,t.optional)(e.JsonStruct),stack:(0,t.optional)((0,t.string)())}),e.JsonRpcParamsStruct=(0,t.optional)((0,t.union)([(0,t.record)((0,t.string)(),e.JsonStruct),(0,t.array)(e.JsonStruct)])),e.JsonRpcRequestStruct=(0,t.object)({id:e.JsonRpcIdStruct,jsonrpc:e.JsonRpcVersionStruct,method:(0,t.string)(),params:e.JsonRpcParamsStruct}),e.JsonRpcNotificationStruct=(0,t.omit)(e.JsonRpcRequestStruct,["id"]);function o(a){return(0,t.is)(a,e.JsonRpcNotificationStruct)}e.isJsonRpcNotification=o;function l(a,_){(0,n.assertStruct)(a,e.JsonRpcNotificationStruct,"Invalid JSON-RPC notification",_)}e.assertIsJsonRpcNotification=l;function h(a){return(0,t.is)(a,e.JsonRpcRequestStruct)}e.isJsonRpcRequest=h;function c(a,_){(0,n.assertStruct)(a,e.JsonRpcRequestStruct,"Invalid JSON-RPC request",_)}e.assertIsJsonRpcRequest=c,e.PendingJsonRpcResponseStruct=(0,t.object)({id:e.JsonRpcIdStruct,jsonrpc:e.JsonRpcVersionStruct,result:(0,t.optional)((0,t.unknown)()),error:(0,t.optional)(e.JsonRpcErrorStruct)}),e.JsonRpcSuccessStruct=(0,t.object)({id:e.JsonRpcIdStruct,jsonrpc:e.JsonRpcVersionStruct,result:e.JsonStruct}),e.JsonRpcFailureStruct=(0,t.object)({id:e.JsonRpcIdStruct,jsonrpc:e.JsonRpcVersionStruct,error:e.JsonRpcErrorStruct}),e.JsonRpcResponseStruct=(0,t.union)([e.JsonRpcSuccessStruct,e.JsonRpcFailureStruct]);function m(a){return(0,t.is)(a,e.PendingJsonRpcResponseStruct)}e.isPendingJsonRpcResponse=m;function g(a,_){(0,n.assertStruct)(a,e.PendingJsonRpcResponseStruct,"Invalid pending JSON-RPC response",_)}e.assertIsPendingJsonRpcResponse=g;function p(a){return(0,t.is)(a,e.JsonRpcResponseStruct)}e.isJsonRpcResponse=p;function U(a,_){(0,n.assertStruct)(a,e.JsonRpcResponseStruct,"Invalid JSON-RPC response",_)}e.assertIsJsonRpcResponse=U;function Je(a){return(0,t.is)(a,e.JsonRpcSuccessStruct)}e.isJsonRpcSuccess=Je;function Ee(a,_){(0,n.assertStruct)(a,e.JsonRpcSuccessStruct,"Invalid JSON-RPC success response",_)}e.assertIsJsonRpcSuccess=Ee;function Pe(a){return(0,t.is)(a,e.JsonRpcFailureStruct)}e.isJsonRpcFailure=Pe;function je(a,_){(0,n.assertStruct)(a,e.JsonRpcFailureStruct,"Invalid JSON-RPC failure response",_)}e.assertIsJsonRpcFailure=je;function Ve(a){return(0,t.is)(a,e.JsonRpcErrorStruct)}e.isJsonRpcError=Ve;function Ne(a,_){(0,n.assertStruct)(a,e.JsonRpcErrorStruct,"Invalid JSON-RPC error",_)}e.assertIsJsonRpcError=Ne;function Oe(a){const{permitEmptyString:_,permitFractions:M,permitNull:k}=Object.assign({permitEmptyString:!0,permitFractions:!1,permitNull:!0},a);return T=>!!(typeof T=="number"&&(M||Number.isInteger(T))||typeof T=="string"&&(_||T.length>0)||k&&T===null)}e.getJsonRpcIdValidator=Oe})(Re);var pe={};Object.defineProperty(pe,"__esModule",{value:!0});var P={},Rt=d&&d.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(P,"__esModule",{value:!0});P.createModuleLogger=P.createProjectLogger=void 0;const pt=Rt(Me),Bt=(0,pt.default)("metamask");function vt(e){return Bt.extend(e)}P.createProjectLogger=vt;function It(e,t){return e.extend(t)}P.createModuleLogger=It;var Be={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.calculateNumberSize=e.calculateStringSize=e.isASCII=e.isPlainObject=e.ESCAPE_CHARACTERS_REGEXP=e.JsonSize=e.hasProperty=e.isObject=e.isNullOrUndefined=e.isNonEmptyArray=void 0;function t(c){return Array.isArray(c)&&c.length>0}e.isNonEmptyArray=t;function n(c){return c==null}e.isNullOrUndefined=n;function r(c){return!!c&&typeof c=="object"&&!Array.isArray(c)}e.isObject=r;const i=(c,m)=>Object.hasOwnProperty.call(c,m);e.hasProperty=i,function(c){c[c.Null=4]="Null",c[c.Comma=1]="Comma",c[c.Wrapper=1]="Wrapper",c[c.True=4]="True",c[c.False=5]="False",c[c.Quote=1]="Quote",c[c.Colon=1]="Colon",c[c.Date=24]="Date"}(e.JsonSize||(e.JsonSize={})),e.ESCAPE_CHARACTERS_REGEXP=/"|\\|\n|\r|\t/gu;function s(c){if(typeof c!="object"||c===null)return!1;try{let m=c;for(;Object.getPrototypeOf(m)!==null;)m=Object.getPrototypeOf(m);return Object.getPrototypeOf(c)===m}catch{return!1}}e.isPlainObject=s;function o(c){return c.charCodeAt(0)<=127}e.isASCII=o;function l(c){var m;return c.split("").reduce((p,U)=>o(U)?p+1:p+2,0)+((m=c.match(e.ESCAPE_CHARACTERS_REGEXP))!==null&&m!==void 0?m:[]).length}e.calculateStringSize=l;function h(c){return c.toString().length}e.calculateNumberSize=h})(Be);var I={};Object.defineProperty(I,"__esModule",{value:!0});I.hexToBigInt=I.hexToNumber=I.bigIntToHex=I.numberToHex=void 0;const J=b,V=A,kt=e=>((0,J.assert)(typeof e=="number","Value must be a number."),(0,J.assert)(e>=0,"Value must be a non-negative number."),(0,J.assert)(Number.isSafeInteger(e),"Value is not a safe integer. Use `bigIntToHex` instead."),(0,V.add0x)(e.toString(16)));I.numberToHex=kt;const wt=e=>((0,J.assert)(typeof e=="bigint","Value must be a bigint."),(0,J.assert)(e>=0,"Value must be a non-negative bigint."),(0,V.add0x)(e.toString(16)));I.bigIntToHex=wt;const Tt=e=>{(0,V.assertIsHexString)(e);const t=parseInt(e,16);return(0,J.assert)(Number.isSafeInteger(t),"Value is not a safe integer. Use `hexToBigInt` instead."),t};I.hexToNumber=Tt;const Jt=e=>((0,V.assertIsHexString)(e),BigInt((0,V.add0x)(e)));I.hexToBigInt=Jt;var ve={};Object.defineProperty(ve,"__esModule",{value:!0});var Ie={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.timeSince=e.inMilliseconds=e.Duration=void 0,function(s){s[s.Millisecond=1]="Millisecond",s[s.Second=1e3]="Second",s[s.Minute=6e4]="Minute",s[s.Hour=36e5]="Hour",s[s.Day=864e5]="Day",s[s.Week=6048e5]="Week",s[s.Year=31536e6]="Year"}(e.Duration||(e.Duration={}));const t=s=>Number.isInteger(s)&&s>=0,n=(s,o)=>{if(!t(s))throw new Error(`"${o}" must be a non-negative integer. Received: "${s}".`)};function r(s,o){return n(s,"count"),s*o}e.inMilliseconds=r;function i(s){return n(s,"timestamp"),Date.now()-s}e.timeSince=i})(Ie);var ke={};Object.defineProperty(ke,"__esModule",{value:!0});var we={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.satisfiesVersionRange=e.gtRange=e.gtVersion=e.assertIsSemVerRange=e.assertIsSemVerVersion=e.isValidSemVerRange=e.isValidSemVerVersion=e.VersionRangeStruct=e.VersionStruct=void 0;const t=Le,n=w,r=b;e.VersionStruct=(0,n.refine)((0,n.string)(),"Version",g=>(0,t.valid)(g)===null?`Expected SemVer version, got "${g}"`:!0),e.VersionRangeStruct=(0,n.refine)((0,n.string)(),"Version range",g=>(0,t.validRange)(g)===null?`Expected SemVer range, got "${g}"`:!0);function i(g){return(0,n.is)(g,e.VersionStruct)}e.isValidSemVerVersion=i;function s(g){return(0,n.is)(g,e.VersionRangeStruct)}e.isValidSemVerRange=s;function o(g){(0,r.assertStruct)(g,e.VersionStruct)}e.assertIsSemVerVersion=o;function l(g){(0,r.assertStruct)(g,e.VersionRangeStruct)}e.assertIsSemVerRange=l;function h(g,p){return(0,t.gt)(g,p)}e.gtVersion=h;function c(g,p){return(0,t.gtr)(g,p)}e.gtRange=c;function m(g,p){return(0,t.satisfies)(g,p,{includePrerelease:!0})}e.satisfiesVersionRange=m})(we);(function(e){var t=d&&d.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var l=Object.getOwnPropertyDescriptor(i,s);(!l||("get"in l?!i.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,l)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),n=d&&d.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&t(i,r,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(b,e),n(O,e),n(u,e),n($,e),n(v,e),n(E,e),n(ye,e),n(A,e),n(Re,e),n(pe,e),n(P,e),n(Be,e),n(I,e),n(ve,e),n(Ie,e),n(ke,e),n(we,e)})(ae);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createModuleLogger=e.projectLogger=void 0;const t=ae;Object.defineProperty(e,"createModuleLogger",{enumerable:!0,get:function(){return t.createModuleLogger}}),e.projectLogger=(0,t.createProjectLogger)("eth-block-tracker")})(oe);var Te=d&&d.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(L,"__esModule",{value:!0});L.PollingBlockTracker=void 0;const Et=Te(ce),Pt=Te($e),jt=N,re=oe,se=(0,re.createModuleLogger)(re.projectLogger,"polling-block-tracker"),Vt=(0,Et.default)(),Nt=1e3;class Ot extends jt.BaseBlockTracker{constructor(t={}){var n;if(!t.provider)throw new Error("PollingBlockTracker - no provider specified.");super(Object.assign(Object.assign({},t),{blockResetDuration:(n=t.blockResetDuration)!==null&&n!==void 0?n:t.pollingInterval})),this._provider=t.provider,this._pollingInterval=t.pollingInterval||20*Nt,this._retryTimeout=t.retryTimeout||this._pollingInterval/10,this._keepEventLoopActive=t.keepEventLoopActive===void 0?!0:t.keepEventLoopActive,this._setSkipCacheFlag=t.setSkipCacheFlag||!1}async checkForLatestBlock(){return await this._updateLatestBlock(),await this.getLatestBlock()}async _start(){this._synchronize()}async _end(){}async _synchronize(){for(var t;this._isRunning;)try{await this._updateLatestBlock();const n=ie(this._pollingInterval,!this._keepEventLoopActive);this.emit("_waitingForNextIteration"),await n}catch(n){const r=new Error(`PollingBlockTracker - encountered an error while attempting to update latest block:
${(t=n.stack)!==null&&t!==void 0?t:n}`);try{this.emit("error",r)}catch{console.error(r)}const i=ie(this._retryTimeout,!this._keepEventLoopActive);this.emit("_waitingForNextIteration"),await i}}async _updateLatestBlock(){const t=await this._fetchLatestBlock();this._newPotentialLatest(t)}async _fetchLatestBlock(){const t={jsonrpc:"2.0",id:Vt(),method:"eth_blockNumber",params:[]};this._setSkipCacheFlag&&(t.skipCache=!0),se("Making request",t);const n=await(0,Pt.default)(r=>this._provider.sendAsync(t,r))();if(se("Got response",n),n.error)throw new Error(`PollingBlockTracker - encountered error fetching block:
${n.error.message}`);return n.result}}L.PollingBlockTracker=Ot;function ie(e,t){return new Promise(n=>{const r=setTimeout(n,e);r.unref&&t&&r.unref()})}var F={},At=d&&d.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(F,"__esModule",{value:!0});F.SubscribeBlockTracker=void 0;const Mt=At(ce),Lt=N,Ct=(0,Mt.default)();class $t extends Lt.BaseBlockTracker{constructor(t={}){if(!t.provider)throw new Error("SubscribeBlockTracker - no provider specified.");super(t),this._provider=t.provider,this._subscriptionId=null}async checkForLatestBlock(){return await this.getLatestBlock()}async _start(){if(this._subscriptionId===void 0||this._subscriptionId===null)try{const t=await this._call("eth_blockNumber");this._subscriptionId=await this._call("eth_subscribe","newHeads"),this._provider.on("data",this._handleSubData.bind(this)),this._newPotentialLatest(t)}catch(t){this.emit("error",t)}}async _end(){if(this._subscriptionId!==null&&this._subscriptionId!==void 0)try{await this._call("eth_unsubscribe",this._subscriptionId),this._subscriptionId=null}catch(t){this.emit("error",t)}}_call(t,...n){return new Promise((r,i)=>{this._provider.sendAsync({id:Ct(),method:t,params:n,jsonrpc:"2.0"},(s,o)=>{s?i(s):r(o.result)})})}_handleSubData(t,n){var r;n.method==="eth_subscription"&&((r=n.params)===null||r===void 0?void 0:r.subscription)===this._subscriptionId&&this._newPotentialLatest(n.params.result.number)}}F.SubscribeBlockTracker=$t;(function(e){var t=d&&d.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s),Object.defineProperty(r,o,{enumerable:!0,get:function(){return i[s]}})}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),n=d&&d.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&t(i,r,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(L,e),n(F,e)})(Ce);export{Ce as d};
