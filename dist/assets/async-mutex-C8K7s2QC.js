import{r as l}from"./tslib-iwng_IcJ.js";var m={},f={},c={};Object.defineProperty(c,"__esModule",{value:!0});var _=l,w=function(){function e(r){if(this._maxConcurrency=r,this._queue=[],r<=0)throw new Error("semaphore must be initialized to a positive value");this._value=r}return e.prototype.acquire=function(){var r=this,t=this.isLocked(),i=new Promise(function(a){return r._queue.push(a)});return t||this._dispatch(),i},e.prototype.runExclusive=function(r){return _.__awaiter(this,void 0,void 0,function(){var t,i,a;return _.__generator(this,function(u){switch(u.label){case 0:return[4,this.acquire()];case 1:t=u.sent(),i=t[0],a=t[1],u.label=2;case 2:return u.trys.push([2,,4,5]),[4,r(i)];case 3:return[2,u.sent()];case 4:return a(),[7];case 5:return[2]}})})},e.prototype.isLocked=function(){return this._value<=0},e.prototype.release=function(){if(this._maxConcurrency>1)throw new Error("this method is unavailabel on semaphores with concurrency > 1; use the scoped release returned by acquire instead");if(this._currentReleaser){var r=this._currentReleaser;this._currentReleaser=void 0,r()}},e.prototype._dispatch=function(){var r=this,t=this._queue.shift();if(t){var i=!1;this._currentReleaser=function(){i||(i=!0,r._value++,r._dispatch())},t([this._value--,this._currentReleaser])}},e}();c.default=w;Object.defineProperty(f,"__esModule",{value:!0});var p=l,y=c,b=function(){function e(){this._semaphore=new y.default(1)}return e.prototype.acquire=function(){return p.__awaiter(this,void 0,void 0,function(){var r,t;return p.__generator(this,function(i){switch(i.label){case 0:return[4,this._semaphore.acquire()];case 1:return r=i.sent(),t=r[1],[2,t]}})})},e.prototype.runExclusive=function(r){return this._semaphore.runExclusive(function(){return r()})},e.prototype.isLocked=function(){return this._semaphore.isLocked()},e.prototype.release=function(){this._semaphore.release()},e}();f.default=b;var h={};Object.defineProperty(h,"__esModule",{value:!0});h.withTimeout=void 0;var o=l;function q(e,r,t){var i=this;return t===void 0&&(t=new Error("timeout")),{acquire:function(){return new Promise(function(a,u){return o.__awaiter(i,void 0,void 0,function(){var s,n,v;return o.__generator(this,function(d){switch(d.label){case 0:return s=!1,setTimeout(function(){s=!0,u(t)},r),[4,e.acquire()];case 1:return n=d.sent(),s?(v=Array.isArray(n)?n[1]:n,v()):a(n),[2]}})})})},runExclusive:function(a){return o.__awaiter(this,void 0,void 0,function(){var u,s;return o.__generator(this,function(n){switch(n.label){case 0:u=function(){},n.label=1;case 1:return n.trys.push([1,,7,8]),[4,this.acquire()];case 2:return s=n.sent(),Array.isArray(s)?(u=s[1],[4,a(s[0])]):[3,4];case 3:return[2,n.sent()];case 4:return u=s,[4,a()];case 5:return[2,n.sent()];case 6:return[3,8];case 7:return u(),[7];case 8:return[2]}})})},release:function(){e.release()},isLocked:function(){return e.isLocked()}}}h.withTimeout=q;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.withTimeout=e.Semaphore=e.Mutex=void 0;var r=f;Object.defineProperty(e,"Mutex",{enumerable:!0,get:function(){return r.default}});var t=c;Object.defineProperty(e,"Semaphore",{enumerable:!0,get:function(){return t.default}});var i=h;Object.defineProperty(e,"withTimeout",{enumerable:!0,get:function(){return i.withTimeout}})})(m);export{m as l};
